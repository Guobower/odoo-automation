---
  - name: Run Odoo
    hosts: odoo
    pre_tasks:
      - name: 'Install python2'
        become: true
        become_user: root
        raw: apt-get -y install python-simplejson
    vars:
      pg_password: "{{ lookup('password', '~/ansible/postgres-password chars=ascii_letters,digits') }}"
      server_admin_password: "{{ lookup('password', '~/ansible/server-password chars=ascii_letters,digits') }}"
      user_odoo_password: "{{ lookup('password', '~/ansible/odoo-user-password chars=ascii_letters,digits') }}"
    vars_prompt:
      - name: "pg_user"
        prompt: "Digite o nome do usuario postgres"
        default: odoo
        private: no
        prompt: "Digite a porta no qual o Odoo vai rodar"
        default: 8090
        private: no

    tasks:
      - name: Configura usuário padrão
        become: true
        become_user: root
        user:
          name: odoo
          uid: 1040
          shell: /bin/bash
          groups: sudo
          append: yes
          password: "{{user_odoo_password}}"

      - name: Inicia o docker odoo
        become: yes
        become_user: odoo
        docker_container:
          name: trustcode-odoo
          image: trustcode/docker-odoo
          network_mode: host
          restart: yes
          state: started
          env:
            PG_USER: "{{ pg_user }}"
            PG_PASSWORD: "{{ pg_password }}"
            PORT: "{{ odoo_port }}"
