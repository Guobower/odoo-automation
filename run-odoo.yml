---
  - name: Run Odoo
    hosts: odoo
    pre_tasks:
      - name: 'Install python2'
        become: true
        become_user: root
        raw: apt-get -y install python-simplejson
    vars_prompt:
      - name: "pg_user"
        prompt: "Digite o nome do usuario postgres"
        default: odoo
        private: no
      - name: "pg_password"
        prompt: "Digite a senha do usuario postgres"
      - name: "odoo_port"
        prompt: "Digite a porta no qual o Odoo vai rodar"
        default: 8069
        private: no
      - name: "user_password"
        prompt: "Enter a password for the user"
        private: yes
        encrypt: "md5_crypt" #need to have python-passlib installed in local machine before we can use it
        confirm: yes
        salt_size: 7

    tasks:
      - name: Configura usuário padrão
        become: true
        become_user: root
        user:
          name: odoo
          uid: 1040
          shell: /bin/bash
          groups: sudo
          append: yes
          password: "{{user_password}}"
      - name: Inicia o docker odoo
        become: yes
        become_user: odoo
        docker_container:
          name: trustcode-odoo
          image: trustcode/docker-odoo
          network_mode: host
          restart: yes
          state: started
          env:
            PG_USER: "{{ pg_user }}"
            PG_PASSWORD: "{{ pg_password }}"
            PORT: "{{ odoo_port }}"
